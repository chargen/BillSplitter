<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bill Splitting Interface</title>
<script
src="https://code.jquery.com/jquery-3.2.1.min.js"
integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
crossorigin="anonymous">
</script>
<script
src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../style.css">
</head>
<header>
	<div id="top_bar">
		BillSplitter
	</div>
	</header>
<body>
<script>
(function() {
  	//for testing, using below JSON object hosted on my websys account
	var JSONObjectURL = "http://websys3.stern.nyu.edu/~gs2723/websys/JSON_text.js";
	var targetID;
	var targetName;
	var payloadID;
	var payloadName;
	var returnJSON = {};
	// the DB_call object specifies the data to be sent to server; not relevant in test case.
	$('body').html($('<div />', {class: 'container'}));
	$(".container").html("Drag People to Items");
	$('<div />',{ class: "wrapper", width: "300px", height: "300px", borderstyle: "solid", color: "#ccc", padding: "10px"}).appendTo('.container');
	$.getJSON(JSONObjectURL)
		.done(function(data) {
			console.log("done loading")
			var peopleList = [];
			$.each(data, function( key, val ) {
			 if (key === "itemList") {
				console.log("itemList Found");
				$('.wrapper').append($('<div />', {class: 'items'}));
				$('.wrapper').append($('<div />', {class: 'people'}));
				$('.items').css({"float":"right","width":"50%"});
				$('.people').css({"display":"flex","flex-direction": "column","float":"left","width":"50%"});
				// should be style="width: 50%, float:left
				 //Create item list
				$.each(data.itemList, function(i, val){
					$('<div />', { id: val["itemId"], class: "item", text: val["itemName"], width: "400px", align: "right"}).appendTo('.items');
					$("#"+val["itemID"]).after("<br>");
					$(".item");
					$('.item').droppable({accept: ".person",
										 drop: function(event,ui){
											 targetID = event.target.id;
											 targetName = $(event.target).text();
											 payloadID = ui.draggable.prop("id");
											 payloadName = ui.draggable.text();
											 if (targetName in returnJSON) {
												 returnJSON[targetName]["peopleList"].push({"personID":Number(payloadID),"name":payloadName});
											 }
											 else {
												returnJSON[targetName] = { "itemId" : Number(targetID),"peopleList": [{ "personID" : Number(payloadID), "name" : payloadName}]};	 
											 };
											 console.log("returnJSON:"+JSON.stringify(returnJSON))
										 }});
					console.log("itemList Generated");
					var peopleListTemp = val.peopleList
					//console.log(peopleListTemp)
					//Create unique people list; Still need to de-duplicate/tweak.
					$.each(peopleListTemp, function(index, value){
						//console.log("personID:"+value.personID+" name:"+value.name)
						if ($.inArray(value, peopleList) === -1) peopleList.push(value);
						});
				//console.log(peopleList)
				//Create people User Interface.
			$.each(peopleList,function(instance, value){
				function slicer(name) {
					if (name.search(" ") > 0) {
						var n = name.search(" ")+1;
						var n2 = n+1;
						return name.slice(n, n2);
					} else {
						return "";
					}
					
				}
	
				$('<div />', { id: value["personID"], class: "person", text: (value["name"].slice(0, 2) + " " + slicer(value["name"]))}).appendTo('.people');
				$('.person');
				$('.person').draggable({containment: ".wrapper", scroll: false, snap: ".item", snapMode: "inner", revert: "invalid"});
													}
					 );
					
					
					
													}
					   );

										}
											}
					  )
								}
			  );
	
      		}
)();
</script>
<div></div>
</body>
</html>
